---
layout: page
title: Horse Racing Mini Game
permalink: /horse-racing/
---

<div class="race-game">
  <h2>Horse Racing Mini Game</h2>
  <p>Pick a number between 1 and 8, back your favorite, and see if you can call the winner.</p>
  <form class="race-form" data-race-form>
    <label for="horse-choice">Choose your horse</label>
    <div class="race-form__controls">
      <select id="horse-choice" name="horse-choice" required>
        <option value="" selected disabled>Select a horse</option>
        <option value="1" data-horse-option>Horse 1</option>
        <option value="2" data-horse-option>Horse 2</option>
        <option value="3" data-horse-option>Horse 3</option>
        <option value="4" data-horse-option>Horse 4</option>
        <option value="5" data-horse-option>Horse 5</option>
        <option value="6" data-horse-option>Horse 6</option>
        <option value="7" data-horse-option>Horse 7</option>
        <option value="8" data-horse-option>Horse 8</option>
      </select>
      <button type="submit" class="btn btn-primary" data-race-start>Start Race</button>
      <button type="button" class="btn btn-secondary" data-race-reset disabled>Reset</button>
    </div>
  </form>
  <p class="race-status" data-race-status>Select a horse to begin.</p>
  <div class="race-track" data-race-track>
    <div class="lane" data-lane>
      <span class="lane__label" data-horse-label><span>Horse 1</span></span>
      <div class="horse" data-horse="1" aria-label="Horse 1">
        <span class="horse__icon" aria-hidden="true">&#x1F434;</span>
      </div>
    </div>
    <div class="lane" data-lane>
      <span class="lane__label" data-horse-label><span>Horse 2</span></span>
      <div class="horse" data-horse="2" aria-label="Horse 2">
        <span class="horse__icon" aria-hidden="true">&#x1F434;</span>
      </div>
    </div>
    <div class="lane" data-lane>
      <span class="lane__label" data-horse-label><span>Horse 3</span></span>
      <div class="horse" data-horse="3" aria-label="Horse 3">
        <span class="horse__icon" aria-hidden="true">&#x1F434;</span>
      </div>
    </div>
    <div class="lane" data-lane>
      <span class="lane__label" data-horse-label><span>Horse 4</span></span>
      <div class="horse" data-horse="4" aria-label="Horse 4">
        <span class="horse__icon" aria-hidden="true">&#x1F434;</span>
      </div>
    </div>
    <div class="lane" data-lane>
      <span class="lane__label" data-horse-label><span>Horse 5</span></span>
      <div class="horse" data-horse="5" aria-label="Horse 5">
        <span class="horse__icon" aria-hidden="true">&#x1F434;</span>
      </div>
    </div>
    <div class="lane" data-lane>
      <span class="lane__label" data-horse-label><span>Horse 6</span></span>
      <div class="horse" data-horse="6" aria-label="Horse 6">
        <span class="horse__icon" aria-hidden="true">&#x1F434;</span>
      </div>
    </div>
    <div class="lane" data-lane>
      <span class="lane__label" data-horse-label><span>Horse 7</span></span>
      <div class="horse" data-horse="7" aria-label="Horse 7">
        <span class="horse__icon" aria-hidden="true">&#x1F434;</span>
      </div>
    </div>
    <div class="lane" data-lane>
      <span class="lane__label" data-horse-label><span>Horse 8</span></span>
      <div class="horse" data-horse="8" aria-label="Horse 8">
        <span class="horse__icon" aria-hidden="true">&#x1F434;</span>
      </div>
    </div>
  </div>
</div>

<style>
.race-game {
  margin-top: 2rem;
  max-width: 900px;
}

.race-form {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.race-form label {
  font-weight: 600;
}

.race-form__controls {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  align-items: center;
}

.race-form select {
  min-width: 160px;
  padding: 0.5rem;
  border: 1px solid var(--border-color, #ccc);
  border-radius: 0.5rem;
  background: var(--select-background, #fff);
  color: inherit;
}

.race-status {
  margin-top: 0.5rem;
  font-weight: 600;
}

.race-status[data-status="info"] {
  color: var(--text-muted, #555);
}

.race-status[data-status="success"] {
  color: #2f855a;
}

.race-status[data-status="warning"] {
  color: #b7791f;
}

.race-track {
  position: relative;
  margin-top: 2rem;
  border: 2px solid var(--border-color, #ccc);
  border-radius: 1rem;
  padding: 1.5rem 1rem 1.5rem 0.5rem;
  background: linear-gradient(180deg, rgba(0,0,0,0.05) 0%, rgba(0,0,0,0.03) 100%);
  overflow: hidden;
}

.lane {
  position: relative;
  display: flex;
  align-items: center;
  height: 56px;
  margin-bottom: 0.75rem;
  padding-left: 140px;
  justify-content: center;
  text-align: center;
  border-radius: 0.75rem;
  background: rgba(255, 255, 255, 0.85);
  box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.06);
}

.lane:last-child {
  margin-bottom: 0;
}

.lane:nth-child(even) {
  background: rgba(240, 240, 240, 0.85);
}

.lane::after {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  width: 14px;
  height: 100%;
  background-image: linear-gradient(45deg, rgba(0,0,0,0.35) 25%, transparent 25%, transparent 50%, rgba(0,0,0,0.35) 50%, rgba(0,0,0,0.35) 75%, transparent 75%, transparent);
  background-size: 12px 12px;
}

.lane--winner {
  box-shadow: 0 0 0 3px rgba(47, 133, 90, 0.4);
}

.lane__label {
  position: relative;
  left: auto;
  margin-right: auto;
  margin-left: auto;
  font-weight: 600;
  color: var(--text-muted, #444);
  line-height: 1.2;
  max-width: 320px;
}

.lane__label span {
  display: inline-block;
  background: rgba(255, 255, 255, 0.85);
  padding: 0.15rem 0.65rem;
  border-radius: 999px;
  box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.08);
}

.horse {
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  transition: left 0.12s ease-out;
}

.horse__icon {
  display: inline-block;
  font-size: 2rem;
  line-height: 1;
  transform: scaleX(-1);
}

@media (max-width: 640px) {
  .race-track {
    padding-left: 0.5rem;
    padding-right: 0.5rem;
  }

  .lane {
    padding-left: 118px;
    height: 48px;
  }

  .lane__label {
    max-width: 280px;
  }

  .horse {
    width: 40px;
    height: 40px;
  }

  .horse__icon {
    font-size: 1.8rem;
  }
}
</style>

<script>
(function () {
  var form = document.querySelector('[data-race-form]');
  if (!form) {
    return;
  }

  var umaMusumePool = [
    'Special Week',
    'Silence Suzuka',
    'Tokai Teio',
    'Mejiro McQueen',
    'Grass Wonder',
    'El Condor Pasa',
    'Taiki Shuttle',
    'Gold Ship',
    'Vodka',
    'Daiwa Scarlet',
    'Nice Nature',
    'Winning Ticket',
    'Narita Brian',
    'Biwa Hayahide',
    'Kitasan Black',
    'Satono Diamond',
    'Hishi Amazon',
    'King Halo',
    'Agnes Tachyon',
    'Air Groove',
    'Symboli Rudolf',
    'Mayano Top Gun',
    'Rice Shower',
    'Twin Turbo'
  ];

  var select = form.querySelector('#horse-choice');
  var startButton = form.querySelector('[data-race-start]');
  var resetButton = form.querySelector('[data-race-reset]');
  var status = document.querySelector('[data-race-status]');
  var lanes = Array.prototype.slice.call(document.querySelectorAll('[data-lane]'));
  var horses = lanes.map(function (lane) {
    return lane.querySelector('[data-horse]');
  });
  var selectOptions = select ? Array.prototype.slice.call(select.querySelectorAll('[data-horse-option]')) : [];

  var raceTimer = null;
  var raceActive = false;

  function getRandomizedNames(count) {
    var pool = umaMusumePool.slice();
    for (var i = pool.length - 1; i > 0; i -= 1) {
      var j = Math.floor(Math.random() * (i + 1));
      var temp = pool[i];
      pool[i] = pool[j];
      pool[j] = temp;
    }
    return pool.slice(0, count);
  }

  function assignHorseNames() {
    var names = getRandomizedNames(horses.length);
    names.forEach(function (name, index) {
      var laneLabel = lanes[index] ? lanes[index].querySelector('[data-horse-label] span') : null;
      if (laneLabel) {
        laneLabel.textContent = name;
      }
      var horse = horses[index];
      if (horse) {
        horse.setAttribute('aria-label', name + ' lane');
        horse.setAttribute('data-horse-name', name);
      }
      var option = selectOptions[index];
      if (option) {
        option.textContent = name;
        option.value = String(index + 1);
        option.setAttribute('data-horse-name', name);
      }
    });
  }

  function setStatus(message, variant) {
    if (!status) {
      return;
    }
    status.textContent = message;
    status.setAttribute('data-status', variant || 'info');
  }

  function clearRaceTimer() {
    if (raceTimer) {
      window.clearInterval(raceTimer);
      raceTimer = null;
    }
    raceActive = false;
  }

  function resetPositions() {
    lanes.forEach(function (lane) {
      lane.classList.remove('lane--winner');
    });
    horses.forEach(function (horse) {
      horse.style.left = '0px';
    });
  }

  function resetRace(notice, options) {
    var settings = options || {};
    clearRaceTimer();
    resetPositions();
    if (settings.reassignNames) {
      assignHorseNames();
    }
    if (startButton) {
      startButton.disabled = false;
    }
    if (select) {
      select.disabled = false;
      select.value = '';
    }
    if (resetButton) {
      resetButton.disabled = true;
    }
    if (notice) {
      setStatus(notice, 'info');
    } else {
      setStatus('Select a horse to begin.', 'info');
    }
  }

  function startRace() {
    if (raceActive) {
      return;
    }

    var chosen = select && select.value ? parseInt(select.value, 10) : NaN;
    if (!chosen || chosen < 1 || chosen > horses.length) {
      setStatus('Pick a horse before starting the race.', 'warning');
      return;
    }

    var chosenIndex = chosen - 1;
    var chosenHorseName = horses[chosenIndex] ? horses[chosenIndex].getAttribute('data-horse-name') : null;

    raceActive = true;
    if (startButton) {
      startButton.disabled = true;
    }
    if (select) {
      select.disabled = true;
    }
    if (resetButton) {
      resetButton.disabled = true;
    }

    resetPositions();
    setStatus('They are off! Good luck!', 'info');

    var maxPositions = horses.map(function (horse, index) {
      if (!horse || !lanes[index]) {
        return 0;
      }
      var laneWidth = lanes[index].clientWidth;
      var horseWidth = horse.offsetWidth;
      return Math.max(0, laneWidth - horseWidth - 20);
    });

    var positions = horses.map(function () {
      return 0;
    });

    var winnerIndex = null;

    raceTimer = window.setInterval(function () {
      horses.forEach(function (horse, index) {
        if (!horse || winnerIndex !== null) {
          return;
        }

        var burst = Math.random() * 6 + 2;
        positions[index] = Math.min(positions[index] + burst, maxPositions[index]);
        horse.style.left = positions[index] + 'px';

        if (positions[index] >= maxPositions[index] && winnerIndex === null) {
          winnerIndex = index;
          lanes[index].classList.add('lane--winner');
          clearRaceTimer();

          if (startButton) {
            startButton.disabled = false;
          }
          if (select) {
            select.disabled = false;
          }
          if (resetButton) {
            resetButton.disabled = false;
          }

          var winningNumber = index + 1;
          var winningHorse = horses[index];
          var winningName = winningHorse ? winningHorse.getAttribute('data-horse-name') || ('Horse ' + winningNumber) : ('Horse ' + winningNumber);
          if (chosen === winningNumber) {
            setStatus(winningName + ' wins! You picked the winner!', 'success');
          } else {
            var pickedName = chosenHorseName || 'your pick';
            setStatus(winningName + ' takes the win. You backed ' + pickedName + '.', 'info');
          }
        }
      });
    }, 80);
  }

  assignHorseNames();
  setStatus('Select a horse to begin.', 'info');

  form.addEventListener('submit', function (event) {
    event.preventDefault();
    startRace();
  });

  resetButton.addEventListener('click', function () {
    resetRace('Race reset. New horses are at the gate!', { reassignNames: true });
  });

  document.addEventListener('visibilitychange', function () {
    if (document.hidden && raceActive) {
      resetRace('Race paused because the tab lost focus. Start again when you are ready.');
    }
  });
})();
</script>
